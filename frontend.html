<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Passion to Profession Finder</title>
   <!-- Tailwind CSS CDN -->
   <script src="https://cdn.tailwindcss.com"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    html, body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #f0f4f8 0%, #e3e9f7 100%);
        color: #1e293b;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        transition: background 0.5s, color 0.5s;
    }
    body {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        padding: 20px;
        box-sizing: border-box;
    }
    .container {
        background: #fff;
        border-radius: 1.5rem;
        box-shadow: 0 8px 32px rgba(30, 60, 120, 0.13), 0 1.5px 8px rgba(37,99,235,0.07);
        padding: 2.5rem 2rem;
        max-width: 900px;
        width: 100%;
        margin-top: 2rem;
        border: 2px solid #2563eb;
        animation: popIn 0.7s cubic-bezier(0.4,0,0.2,1);
    }
    @keyframes popIn {
        0% { opacity: 0; transform: scale(0.95);}
        80% { opacity: 1; transform: scale(1.03);}
        100% { opacity: 1; transform: scale(1);}
    }
    label, h1, h2, h3, h4, p, span, ul, li {
        color: #1e293b;
        transition: color 0.5s;
    }
    input, textarea {
        background: #f8fafc;
        color: #1e293b;
        border: 2px solid #2563eb;
        transition: background 0.5s, color 0.5s, border 0.5s;
        box-shadow: 0 1px 4px rgba(37,99,235,0.07);
    }
    textarea {
        resize: vertical;
        min-height: 120px;
    }
    .loading-spinner {
        border: 4px solid rgba(37,99,235,0.15);
        border-left-color: #2563eb;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 0.8s cubic-bezier(0.4,0,0.2,1) infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg) scale(1);}
        50% { transform: rotate(180deg) scale(1.15);}
        100% { transform: rotate(360deg) scale(1);}
    }
    button {
        transition: background 0.3s, color 0.3s, transform 0.2s, box-shadow 0.3s;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(37,99,235,0.08);
    }
    button:active {
        transform: scale(0.97);
    }
    /* Card animation: slide in with bounce */
    #suggestedCareersContainer > div {
        animation: bounceInLeft 0.8s cubic-bezier(0.68,-0.55,0.27,1.55);
    }
    @keyframes bounceInLeft {
        0% { opacity: 0; transform: translateX(-80px) scale(0.95);}
        60% { opacity: 1; transform: translateX(20px) scale(1.05);}
        80% { transform: translateX(-5px) scale(0.98);}
        100% { opacity: 1; transform: translateX(0) scale(1);}
    }
    /* Animated underline for headings */
    h1, h2 {
        position: relative;
        overflow: hidden;
    }
    h1::after, h2::after {
        content: "";
        display: block;
        width: 80px;
        height: 5px;
        background: linear-gradient(90deg, #2563eb, #60a5fa, #818cf8);
        border-radius: 2.5px;
        margin: 0.7rem auto 0;
        animation: underlineGrow 1s cubic-bezier(0.4,0,0.2,1);
    }
    @keyframes underlineGrow {
        from { width: 0; }
        to { width: 80px; }
    }
    /* Floating animation for help button */
    #helpButton {
        animation: floatY 2.2s ease-in-out infinite alternate;
    }
    @keyframes floatY {
        0% { transform: translateY(0);}
        100% { transform: translateY(-8px);}
    }
    /* Pulse animation for Find Professions button */
    #findButton {
        animation: pulseGlow 2.5s infinite;
    }
    @keyframes pulseGlow {
        0% { box-shadow: 0 0 0 0 rgba(37,99,235,0.18);}
        70% { box-shadow: 0 0 0 12px rgba(37,99,235,0);}
        100% { box-shadow: 0 0 0 0 rgba(37,99,235,0);}
    }
    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 10px;
        background: #e3e9f7;
    }
    ::-webkit-scrollbar-thumb {
        background: #2563eb;
        border-radius: 6px;
    }
    /* Card hover effect */
    #suggestedCareersContainer > div:hover {
        box-shadow: 0 8px 32px rgba(37,99,235,0.18), 0 2px 8px rgba(37,99,235,0.09);
        transform: translateY(-4px) scale(1.02);
        transition: box-shadow 0.3s, transform 0.3s;
    }
    /* Animated border for general advice */
    #generalAdvice {
        border-width: 2.5px;
        border-image: linear-gradient(90deg, #2563eb, #818cf8) 1;
        animation: borderPulse 2.5s infinite alternate;
    }
    @keyframes borderPulse {
        0% { border-color: #2563eb;}
        100% { border-color: #818cf8;}
    }
    /* Enhanced general advice styling */
    #generalAdviceText {
        line-height: 1.8;
        font-size: 1.05rem;
    }
    .advice-highlight {
        background-color: rgba(255, 255, 0, 0.3);
        padding: 0.1rem 0.3rem;
        border-radius: 0.25rem;
    }
    .advice-list {
        list-style-type: disc;
        padding-left: 1.5rem;
        margin-top: 0.5rem;
    }
    .advice-list li {
        margin-bottom: 0.5rem;
    }
</style>
</head>
<body>
   <div class="container">
    <h1 class="text-4xl font-bold text-center text-gray-800 mb-6">Passion to Profession Finder ðŸš€</h1>
       <p class="text-center text-gray-600 mb-8">
           <b><i>Help your Kids discover future career paths and projects based on their interests!</i></b>
       </p>

       <!-- Help Button -->
       <div class="text-center mb-6">
           <button id="helpButton" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200">
               Get Help with Career Exploration
           </button>
       </div>

       <div class="mb-4">
           <label for="parentName" class="block text-gray-700 text-lg font-medium mb-2">Your Name:</label>
           <input type="text" id="parentName"
                  class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200"
                  placeholder="e.g., Jane Doe">
       </div>

       <div class="mb-6">
           <label for="parentEmail" class="block text-gray-700 text-lg font-medium mb-2">Your Email:</label>
           <input type="email" id="parentEmail"
                  class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200"
                  placeholder="e.g., jane.doe@example.com">
           <p id="emailError" class="text-red-600 text-sm mt-1 hidden">Please enter a valid email address.</p>
       </div>

       <div class="mb-6">
           <label for="parentPhone" class="block text-gray-700 text-lg font-medium mb-2">Your Phone Number:</label>
           <input type="tel" id="parentPhone"
                  class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200"
                  placeholder="e.g., +1 555 123 4567">
       </div>

       <div class="mb-6">
           <label for="interestsInput" class="block text-gray-700 text-lg font-medium mb-2">
               Enter your Kids interests (e.g., art, coding, helping people, storytelling, gaming):
           </label>
           <textarea id="interestsInput"
                     class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200"
                     placeholder="Type interests here, separated by commas or new lines. Examples: art, coding, helping people, storytelling, gaming, science, writing, problem-solving, technology, creativity..."
           ></textarea>
       </div>

       <button id="findButton"
               class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
           <span id="buttonText">Find Professions</span>
           <div id="loadingSpinner" class="loading-spinner ml-2 hidden"></div>
       </button>

       <div id="errorMessage" class="text-red-600 font-medium mt-4 hidden"></div>
       <div id="successMessage" class="text-green-600 font-medium mt-4 hidden"></div>

       <div id="results" class="mt-8 pt-8 border-t border-gray-200 hidden">
           <h2 class="text-3xl font-semibold text-gray-800 mb-6 text-center">Your Teen's Future Paths âœ¨</h2>
           <div id="suggestedCareersContainer">
               <!-- Career suggestions will be dynamically inserted here -->
           </div>
           <div id="generalAdvice" class="mt-8 p-6 bg-indigo-50 border border-indigo-200 rounded-lg">
               <h3 class="text-xl font-semibold text-indigo-800 mb-3">A Note from Your Career Guide ðŸŒŸ</h3>
               <div id="generalAdviceText" class="text-gray-700">
                   <!-- Advice content will be dynamically inserted here -->
               </div>
           </div>
       </div>
   </div>

   <script type="module">
       // IMPORTANT: REPLACE THIS WITH YOUR DEPLOYED GOOGLE APPS SCRIPT WEB APP URL
       const GOOGLE_APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyAsMvXWR3HRhy2TvXU0uBfXTfojhTid3U8dKsbvugMqPD94sz4LK8phFYc41c7wQXa/exec'; 
       const LANDING_PAGE_URL = 'https://link.labdox.com/AI-SC-11'; // Your common landing page URL

       // DOM Elements
       const parentNameInput = document.getElementById('parentName');
       const parentEmailInput = document.getElementById('parentEmail');
       const parentPhoneInput = document.getElementById('parentPhone');
       const interestsInput = document.getElementById('interestsInput');
       const findButton = document.getElementById('findButton');
       const helpButton = document.getElementById('helpButton');
       const buttonText = document.getElementById('buttonText');
       const loadingSpinner = document.getElementById('loadingSpinner');
       const errorMessage = document.getElementById('errorMessage');
       const successMessage = document.getElementById('successMessage');
       const resultsDiv = document.getElementById('results');
       const suggestedCareersContainer = document.getElementById('suggestedCareersContainer');
       const generalAdviceText = document.getElementById('generalAdviceText');
       const emailError = document.getElementById('emailError');

       // Event Listeners
       helpButton.addEventListener('click', () => {
           window.location.href = LANDING_PAGE_URL;
       });

       // Validation Functions
       function isValidEmail(email) {
           const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
           return emailRegex.test(email);
       }

       // Function to format Gemini's advice text
       function formatAdviceText(text) {
           if (!text) return '';
           
           // Convert markdown-like lists to HTML lists
           text = text.replace(/\n\s*-\s*(.*?)(?=\n\s*-|\n\n|$)/g, '\n<li>$1</li>');
           text = text.replace(/(<li>.*<\/li>)+/g, '<ul class="advice-list">$&</ul>');
           
           // Highlight key phrases
           const highlightPhrases = ['important', 'recommend', 'suggest', 'key', 'focus', 'encourage'];
           highlightPhrases.forEach(phrase => {
               const regex = new RegExp(`\\b${phrase}\\b`, 'gi');
               text = text.replace(regex, match => `<span class="advice-highlight">${match}</span>`);
           });
           
           // Convert line breaks to paragraphs
           text = text.split('\n\n').map(para => {
               if (para.startsWith('<ul') || para.startsWith('<li>')) return para;
               return `<p>${para}</p>`;
           }).join('');
           
           return text;
       }

       // Main Function
       findButton.addEventListener('click', async () => {
           // Get input values
           const parentName = parentNameInput.value.trim();
           const parentEmail = parentEmailInput.value.trim();
           const parentPhone = parentPhoneInput.value.trim();
           const interests = interestsInput.value.trim();

           // Reset UI
           errorMessage.classList.add('hidden');
           successMessage.classList.add('hidden');
           emailError.classList.add('hidden');
           resultsDiv.classList.add('hidden');
           suggestedCareersContainer.innerHTML = '';
           generalAdviceText.innerHTML = '<p>Loading personalized advice...</p>';

           // Validate inputs
           if (!parentName || !parentEmail || !interests) {
               errorMessage.textContent = "Please fill in your name, email, and your Kids interests to get started!";
               errorMessage.classList.remove('hidden');
               return;
           }

           if (!isValidEmail(parentEmail)) {
               emailError.classList.remove('hidden');
               return;
           }

           // Prepare UI for loading
           findButton.disabled = true;
           buttonText.textContent = "Finding...";
           loadingSpinner.classList.remove('hidden');

           try {
               // Gemini API Call
               const geminiPrompt = `
                   You are an expert career counselor specializing in guiding Kids based on their diverse interests.
                   A parent has provided their Kids interests: "${interests}".
                   
                   Your task is to:
                   1. Identify 3-5 relevant career fields that strongly align with the provided interests.
                   2. For each career:
                      - Provide a compelling name
                      - Write a 2-3 sentence description explaining why it's a good match
                      - List matching interests
                      - List key skills needed
                      - Suggest 3-5 practical projects the teen can start now
                   3. Provide personalized advice for parents in the "generalAdvice" field (3-4 paragraphs)
                      - Include specific strategies based on the Kids interests
                      - Mention resources or approaches to explore
                      - Highlight important developmental considerations
                      - Provide encouragement and realistic expectations
                      - Format with clear paragraphs and bullet points when appropriate
                   
                   Structure your response as JSON exactly matching this schema:
                   {
                     "suggestedCareers": [
                       {
                         "name": "Career Name",
                         "description": "Why this matches...",
                         "matchingInterests": ["interest1", "interest2"],
                         "skillsNeeded": ["skill1", "skill2"],
                         "suggestedProjects": ["project1", "project2"]
                       }
                     ],
                     "generalAdvice": "Personalized advice for parents..."
                   }
               `;

               const geminiPayload = {
                   contents: [{ role: "user", parts: [{ text: geminiPrompt }] }],
                   generationConfig: {
                       responseMimeType: "application/json",
                       responseSchema: {
                           type: "OBJECT",
                           properties: {
                               "suggestedCareers": {
                                   "type": "ARRAY",
                                   "items": {
                                       "type": "OBJECT",
                                       "properties": {
                                           "name": { "type": "STRING" },
                                           "description": { "type": "STRING" },
                                           "matchingInterests": { "type": "ARRAY", "items": { "type": "STRING" } },
                                           "skillsNeeded": { "type": "ARRAY", "items": { "type": "STRING" } },
                                           "suggestedProjects": { "type": "ARRAY", "items": { "type": "STRING" } }
                                       }
                                   }
                               },
                               "generalAdvice": { "type": "STRING" }
                           }
                       }
                   }
               };

               const geminiApiKey = "AIzaSyAZOOFOWDvk-HUchplXE_3vg649LwVjMU8";
               const geminiApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`;

               // Call Gemini API
               const geminiResponse = await fetch(geminiApiUrl, {
                   method: 'POST',
                   headers: { 'Content-Type': 'application/json' },
                   body: JSON.stringify(geminiPayload)
               });

               const geminiResult = await geminiResponse.json();
               console.log("Gemini API Response:", geminiResult);

               // Process Gemini Response
               let parsedGeminiData;
               if (geminiResult.candidates?.[0]?.content?.parts?.[0]?.text) {
                   parsedGeminiData = JSON.parse(geminiResult.candidates[0].content.parts[0].text);

                   // Display Career Suggestions
                   if (parsedGeminiData.suggestedCareers?.length > 0) {
                       parsedGeminiData.suggestedCareers.forEach(career => {
                           const careerCard = `
                               <div class="bg-gray-50 p-6 rounded-xl shadow-sm mb-6 border border-gray-200">
                                   <h3 class="text-2xl font-semibold text-indigo-700 mb-3">${career.name}</h3>
                                   <p class="text-gray-700 mb-4">${career.description || ''}</p>
                                   <div class="mb-4">
                                       <h4 class="text-lg font-medium text-gray-800 mb-2">Matching Interests:</h4>
                                       <div class="flex flex-wrap gap-2">
                                           ${(career.matchingInterests || []).map(interest => 
                                               `<span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">${interest}</span>`
                                           ).join('')}
                                       </div>
                                   </div>
                                   <div class="mb-4">
                                       <h4 class="text-lg font-medium text-gray-800 mb-2">Skills Needed:</h4>
                                       <ul class="list-disc list-inside text-gray-700 ml-4 space-y-1">
                                           ${(career.skillsNeeded || []).map(skill => `<li>${skill}</li>`).join('')}
                                       </ul>
                                   </div>
                                   <div>
                                       <h4 class="text-lg font-medium text-gray-800 mb-2">Projects to Start Now:</h4>
                                       <ul class="list-disc list-inside text-gray-700 ml-4 space-y-1">
                                           ${(career.suggestedProjects || []).map(project => `<li>${project}</li>`).join('')}
                                       </ul>
                                   </div>
                                   <div class="mt-6 text-center">
                                       <a href="${LANDING_PAGE_URL}" target="_blank" class="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">
                                           Click here for more resources
                                       </a>
                                   </div>
                               </div>
                           `;
                           suggestedCareersContainer.innerHTML += careerCard;
                       });

                       // Display General Advice from Gemini
                       if (parsedGeminiData.generalAdvice) {
                           generalAdviceText.innerHTML = formatAdviceText(parsedGeminiData.generalAdvice);
                       } else {
                           generalAdviceText.innerHTML = `
                               <p>Based on your Kids interests, here are some general recommendations:</p>
                               <ul class="advice-list">
                                   <li>Encourage exploration through hands-on projects in different areas</li>
                                   <li>Focus on developing transferable skills like communication and problem-solving</li>
                                   <li>Connect with professionals in fields of interest for informational interviews</li>
                                   <li>Remember that career paths often change - the goal is discovery, not final decisions</li>
                               </ul>
                           `;
                       }

                       resultsDiv.classList.remove('hidden');
                       successMessage.textContent = "Career suggestions found! Check below.";
                       successMessage.classList.remove('hidden');
                   } else {
                       throw new Error("No career suggestions found");
                   }
               } else {
                   throw new Error("Invalid response from Gemini");
               }

               // Save to Google Sheets (if URL is configured)
               if (GOOGLE_APPS_SCRIPT_WEB_APP_URL && !GOOGLE_APPS_SCRIPT_WEB_APP_URL.includes('example.com')) {
                   const dataToSave = {
                       parentName,
                       parentEmail,
                       parentPhone,
                       teenInterestsInput: interests,
                       geminiResponse: parsedGeminiData
                   };

                   await fetch(GOOGLE_APPS_SCRIPT_WEB_APP_URL, {
                       method: 'POST',
                       mode: 'no-cors',
                       headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                       body: JSON.stringify(dataToSave)
                   });
               }

           } catch (error) {
               console.error("Error:", error);
               errorMessage.textContent = "An error occurred while generating suggestions. Please try again.";
               errorMessage.classList.remove('hidden');
               generalAdviceText.innerHTML = `
                   <p>We couldn't generate personalized advice this time. Here are some general tips:</p>
                   <ul class="advice-list">
                       <li>Try refining your kid's interests - be more specific or combine multiple interests</li>
                       <li>Check your internet connection and try again</li>
                       <li>Focus on what excites your teen rather than just "good careers"</li>
                       <li>Remember that career exploration is a process, not a one-time decision</li>
                   </ul>
               `;
           } finally {
               findButton.disabled = false;
               buttonText.textContent = "Find Professions";
               loadingSpinner.classList.add('hidden');
           }
       });
   </script>
</body>
</html>